#define _USE_MATH_DEFINES
#include "caputo.hpp"
#include <cmath>
#include <stdio.h>
#include <iostream>


/*----------------------------------------------------------------------
 |  Calculations of the caputo derivative
 |  Contains mainly of a scalar and vector version
 |  To Accomadate the dimensions of space, a template the used
 |  The base class contains the precompute for the caputo parameters, which
 |    is the same for all classes
 |
 |  Author: Will Zhang
 |  Dependencies: None
 -----------------------------------------------------------------------*/

namespace caputo {


/*----------------------------------------------------------------------
 |  Caputo Derivative Base Class
 -----------------------------------------------------------------------*/

  void caputo_init::set_pars (double alpha, double Tf, double delta) {
    double freq;
    double val;

    freq = 2*M_PI/Tf;


    this -> alpha = alpha;
    this -> Tf = Tf;
    this -> delta = delta;

    val = interpolate_caputo_parameter_beta(alpha, betam[9]);

    this -> beta0 = val * pow(freq, alpha - 1.0 );

    for (int i = 0; i < 9; i++)
    {
      this -> betas[i] = interpolate_caputo_parameter_beta(alpha, betam[i]) * pow(freq, alpha);
      this -> taus[i]  = interpolate_caputo_parameter_taus(alpha, taum[i] ) / freq;
    }

  }
  // Set parameters for dt, if dt is the same then there is no need to change
  void caputo_init::update_dt (double dt) {
    if ((this->dt != dt) && (dt > 1e-9))
    {
      this -> dt = dt;

      double ek;

      C0 = beta0 / dt;
      K0 = C0;

      for (int k = 0; k < 9; k++)
      {
        ek = exp(-0.5 * dt / taus[k]);
        e2[k] = ek*ek;
        bek[k] = betas[k]*ek;
        K0 = K0 + bek[k];
      }

      K0 = delta * K0;
      K1 = K0 + 1;
    }
  }


/*----------------------------------------------------------------------
 |  Implementation for the derivatives for scalar valued functions
 -----------------------------------------------------------------------*/

  // The caputo derivative
  double caputo_init_scl::caputo_iter (double fn, double dt) {

    update_dt(dt);

    df = fn - f_prev;

    double v  = C0 * df;

    for (int k = 0; k < 9; k++)
    {
      Q[k] = e2[k] * Q[k] + bek[k] * df;
      v = v + Q[k];
    }

    f_prev = fn;

    return v;
  }


  // The solution to the fractional differential equation
  double caputo_init_scl::diffeq_iter( double fn, double dt) {

    update_dt(dt);
    // Stress calculations
    double v = fn + K0 * f_prev;

    for (int k = 0; k < 9; k++)
    {
      v = v - delta * e2[k] * Q[k];
    }
    v = v / K1;

    // Updates
    df = v - f_prev;
    f_prev = v;
    for (int k = 0; k < 9; k++)
    {
      Q[k] = e2[k] * Q[k] + bek[k] * df;
    }

    return v;
  }


/*----------------------------------------------------------------------
 |  Implementation for the derivatives for vector valued functions
 |  Template provides the size for the dimensions. Typical values are 1, 4, 9
 -----------------------------------------------------------------------*/

  // Fractional Derivative
  template<int dim>
  void caputo_init_vec<dim>::caputo_iter(double fn[], double dt, double v[]) {

    int krow;

    update_dt(dt);

    for (int i = 0; i < dim; i++)
    {
      df[i] = fn[i] - f_prev[i];
      v[i] = C0 * df[i];
      f_prev[i] = fn[i];
    }

    krow = 0;
    for (int k = 0; k < 9; k++)
    {
      for (int i = 0; i < dim; i++)
      {
        Q[krow + i] = e2[k] * Q[krow + i] + bek[k] * df[i];
        v[i] = v[i] + Q[krow + i];
      }
      krow += dim;
    }
  }


  // The fractional differential equation
  template<int dim>
  void caputo_init_vec<dim>::diffeq_iter(double fn[], double dt, double v[]) {

    int krow;

    update_dt(dt);

    // Stress calculations
    for (int i = 0; i < dim; i++)
    {
      v[i] = fn[i] + K0 * f_prev[i];
    }

    krow = 0;
    for (int k = 0; k < 9; k++)
    {

      for (int i = 0; i < dim; i++)
      {
        v[i] = v[i] - delta * e2[k] * Q[krow + i];
      }
      krow += dim;
    }
    for (int i = 0; i < dim; i++)
    {
      v[i] = v[i] / K1;
    }

    // Updates
    for (int i = 0; i < dim; i++)
    {
      df[i] = v[i] - f_prev[i];
      f_prev[i] = v[i];
    }

    krow = 0;
    for (int k = 0; k < 9; k++)
    {

      for (int i = 0; i < dim; i++)
      {
        Q[krow + i] = e2[k] * Q[krow + i] + bek[k] * df[i];
      }
      krow += dim;
    }
  }


/*----------------------------------------------------------------------
 |  Tools for interpolation of the precomputed betas and taus
 -----------------------------------------------------------------------*/

/***********************************************************************
 * AUTHOR COMMENTS:
 *
 * These values are given for alpha in the range of [0.01, 1.0] in the
 *    steps of 0.01. There are no values at alpha = 0.0
 *  For betas, beta(0) = 0.0
 *  For taus, tau(0) is unknown, thus extrapolation is used
************************************************************************/

  double interpolate1D_newton_linear(double p1, double p2, double t) {
    return t * (p2 - p1) + p1;
  }

  double extrapolate1D_newton_linear(double p1, double p2, double t) {
    return p1 - (1.0 - t) * (p2 - p1);
  }

  double interpolate_caputo_parameter_arr(const double alpha, const double arr[100]) {
    double as, temp;
    int an;

    temp = alpha * 100.0;


    an = (int) temp;
    as = temp - an;
    if (alpha <= 0.01)
    {
      return arr[0];
    }
    else if (alpha >= 1.0)
    {
      return arr[99];
    }
    else
    {
      return interpolate1D_newton_linear(arr[an-1], arr[an], as);
    }
  }

  double interpolate_caputo_parameter_beta(const double alpha, const double arr[100])
  {
    double as, temp;
    int an;

    temp = alpha * 100.0;


    an = (int) temp;
    as = temp - an;
    if (alpha <= 0.01)
    {
      return interpolate1D_newton_linear(0.0, arr[0], as);
    }
    else if (alpha >= 1.0)
    {
      return arr[99];
    }
    else
    {
      return interpolate1D_newton_linear(arr[an-1], arr[an], as);
    }
  }

  double interpolate_caputo_parameter_taus(const double alpha, const double arr[100])
  {
    double as, temp;
    int an;

    temp = alpha * 100.0;


    an = (int) temp;
    as = temp - an;
    if (alpha <= 0.01)
    {
      return extrapolate1D_newton_linear(arr[0], arr[1], as);
    }
    else if (alpha >= 1.0)
    {
      return arr[99];
    }
    else
    {
      return interpolate1D_newton_linear(arr[an-1], arr[an], as);
    }
  }


/*----------------------------------------------------------------------
 |  The precomputed beta and tau values are given here.
 -----------------------------------------------------------------------*/

/***********************************************************************
 * AUTHOR COMMENTS:
 *
 * For now, only N_p = 9 Prony terms are included (for 500 Fourier series
 *    approximations)
 * More should be imported from the matlab data files at a later time
************************************************************************/

  const double betam[10][100] = {
    {0.01726291472976881,0.03693322603892795,0.0592632084346896,0.08452773107043703,0.11303272467157387,0.14510552421190984,0.18110611610863198,0.22143403220912566,0.266504981540548,0.31681172938704083,0.3728264104955967,0.4351617300315533,0.5043449692543148,0.5811422609266623,0.6661903540362493,0.760287878101658,0.864288473586637,0.9791168122960376,1.1057769397249335,1.2453592488441072,1.3990475258177801,1.5681264025187291,1.7539893073018036,1.9581469528597646,2.1822363879482203,2.428030637740675,2.697448956222627,2.992567714405028,3.3156319466467683,3.6690675771335335,4.055494346587828,4.477739455973929,4.9388519409332385,5.442117783322063,5.991075760908733,6.589534024136608,7.241587380299081,7.951635249848015,8.724400244496426,9.564947298083528,10.478703259196802,11.47147682973509,12.549478703549942,13.719341725036898,14.988140847074943,16.363412618552978,17.85317388060879,19.46593928307254,21.203655824747123,23.095746285930396,25.126263150332257,27.333877523375097,29.698726222570787,32.26660990534335,35.01240775751578,37.975537875314835,41.16392386559625,44.589948300997115,48.267396329597005,52.21063331595898,56.43432579229013,60.95328163435886,65.78229888076528,70.93599183037968,76.42858241624698,82.27364924512683,88.48382681135048,95.07044686790358,102.04311265482893,109.40919546164415,117.1732413876861,125.3362743877295,133.89497972597644,142.84074953713082,152.15856970010643,161.82572395453835,171.81028805779397,182.06938245575031,192.547147784868,203.17240203936387,213.8559325135903,224.48736885451882,234.93157578429432,245.02449515064652,254.56835715453698,263.3261685675595,271.0153730765778,277.13678616613,281.75785823726545,283.8265073645888,283.37243230735027,279.16503700917116,271.0347581914261,257.53102115583226,238.18150952894598,211.27840143036,175.79607342151988,130.05009985197282,72.16810456175548,2.6292346425842093e-10},
    {0.012159490341456355,0.02555891598941401,0.04029162563473059,0.056443453536791276,0.07416125166439816,0.09350675739993794,0.11466712350954975,0.13769714983523662,0.16282401165001123,0.19009740424647922,0.21978502037006953,0.25193526174365477,0.28685617733784047,0.3246000387905821,0.36546887873627976,0.40965326490872955,0.4573766251518118,0.5088797055907616,0.5644184315053364,0.6242641450409165,0.6887042758311305,0.7580431010885513,0.832602532063147,0.9127229122598965,0.9987638204576308,1.0911048724996137,1.1901465152228856,1.296310805552431,1.4100421669665189,1.5318081151965544,1.6620999443260278,1.8014333635300042,1.9503490739755647,2.109413273643199,2.2792180767421097,2.460381831674619,2.653549319921985,2.8593918150805346,3.0786069786527017,3.3119185660776753,3.5600759131121023,3.8238531692249396,4.104048240714153,4.401481402142236,4.716993530096584,5.051443907839377,5.4057075447292995,5.7806719474095765,6.176014204286112,6.596054542708337,7.037205426751214,7.505195703834942,7.99554574368073,8.514978987971636,9.057893350837437,9.629643467066119,10.23003030585807,10.85947738115103,11.518495547913881,12.207535582831747,12.926935459065843,13.676889517766734,14.457420933766226,15.268352593455438,16.109274917071517,16.979510010319036,17.878071673465413,18.80362084380985,19.754415993788314,20.728257984812185,21.72242882080139,22.733623694694757,23.757875674745247,24.79047230276259,25.825863332321983,26.85755873181123,27.878016043370195,28.878516058420953,29.84902572705214,30.77804708147834,31.652450872364533,32.4572934994827,33.17561568967393,33.78822123581321,34.273433998719725,34.60683116948508,34.76095068082919,34.68765383342825,34.40153835149523,33.80276269257547,32.907416829057325,31.608624174051585,29.909897496223817,27.696839079991868,24.95475940427991,21.562757744805314,17.471519147723033,12.583163229116934,6.796246657233747,-4.011004277422203e-13},
    {0.01204620158433038,0.025013506435899596,0.03895335599849895,0.053905014955542334,0.06997261080223388,0.08715814940415006,0.10560044608429253,0.12528297226183943,0.14637706125371847,0.1688482064776474,0.19289921125298756,0.21847978633789944,0.24582271356630514,0.274864873214516,0.30581512159456703,0.3387472436167138,0.37376164230415637,0.41096729530718856,0.4504786843516298,0.4924153647070464,0.536901994827665,0.5840684396413383,0.6340498770461349,0.6869868925552344,0.7430255564268079,0.8023174791245055,0.8650198409999195,0.9312953921430984,1.0013124182617166,1.0752446685987995,1.1532712419379152,1.235576426697285,1.3223494911180382,1.4137844190979778,1.510079586993834,1.6114373757867784,1.718063712539819,1.830167533970915,1.947960164151871,2.0716545973701557,2.2014646762377,2.33760415422668,2.48028563083629,2.6297193466484194,2.7861118245135947,2.9496643418819795,3.120571218460559,3.2990179018331127,3.484626880957951,3.679108103849564,3.8805762897271348,4.09134297289149,4.309098537888707,4.53655646071196,4.770893058193294,5.014167436104346,5.2659414133962565,5.526044103162155,5.794331999881189,6.070624769340431,6.3546838951701865,6.646201583696761,6.9447916818690985,7.249980513438838,7.561197069520645,7.877762373988552,8.198877921434955,8.52361311405385,8.850891615730603,9.179476543603027,9.507954409061758,9.834717714541949,10.157946109262681,10.475585996180174,10.78532848215259,11.084585546660492,11.370464309701452,11.639739257940754,11.888822293693709,12.113730451315678,12.31005112388056,12.47290463264893,12.596903960862647,12.676111461973287,12.703992350426415,12.673364759606647,12.576346155735278,12.398674755170346,12.146850183451265,11.790756744508696,11.33798374095052,10.75767554387039,10.054177156957062,9.195987872421313,8.182858424335667,6.983237541890371,5.587940070591709,3.974271116943185,2.119646476083302,1.0129737761207537e-13},
    {0.012697361099781807,0.026071424302255994,0.04014857461024501,0.054947006285395894,0.07053442084156158,0.08689915548717152,0.10413093962970381,0.12220578764470531,0.1412307324741416,0.1611723043457837,0.18215096528718133,0.20412805818595903,0.22723306588932252,0.2514271840984112,0.27681975790716284,0.3034457885759675,0.3313544838145811,0.3605988495732836,0.39123397394620424,0.42331675152914644,0.45690583992272016,0.4920616459052663,0.5288463062679264,0.5673236557764488,0.6075591790829522,0.6496199442069577,0.6935745153893238,0.739492843438127,0.7874461318957598,0.8375066777346781,0.8897476855276844,0.944243054161633,1.0010671352687694,1.0602944622688595,1.1219994487943448,1.1862560546319396,1.2531374170644722,1.3227154448261915,1.3950603715040983,1.470240264780298,1.5483204875606027,1.629363106755169,1.7134262452138043,1.8005633720810812,1.8908225266061482,1.9842454700856855,2.0808667605548234,2.180712744339826,2.283173983144061,2.3900181396677858,2.498966540317452,2.6123803687708382,2.727661622076737,2.8474960351696628,2.9689008451758414,3.0938507177989965,3.221811358285962,3.352545441887311,3.4858668201860765,3.6215789218597387,3.7594575284924847,3.8992442723685046,4.040642564314799,4.183313921225046,4.3268741908892485,4.470889545227669,4.614872195161123,4.758275805903335,4.900490591236054,5.040838068460118,5.178565453584863,5.312839675402332,5.442740987542971,5.567256154549717,5.685271189862851,5.795563618451125,5.896794241281972,5.987498371886002,6.066076520086432,6.13078449204007,6.179722877787223,6.21082589607741,6.221849564576605,6.2103591622688175,6.173715953146229,6.109063134400057,6.013310977766711,5.87971306969323,5.714348473733332,5.501406654606251,5.247949400714907,4.938565830877769,4.578756212093394,4.153616162657559,3.6664642984319675,3.103299628583997,2.463063238377835,1.7375749710221224,0.9192018697104551,-6.909694272188798e-14},
    {0.013631470141263003,0.027667582930230323,0.04211633984821145,0.05698722106058748,0.07231070320173241,0.08808517548071977,0.10434612259106686,0.12109303678703645,0.13836021891801328,0.1561534078442451,0.17449986910735796,0.1934176814935788,0.2129206995381312,0.2330460698400926,0.25380135239204327,0.2752109323670995,0.2972980954187435,0.3200861319550121,0.3435987348806585,0.36786009318458995,0.39289489666801575,0.41872831224785295,0.44538594583659424,0.4728937919233143,0.5012781702690965,0.5305656487631355,0.5607829516585592,0.5919568528194309,0.6241140539818484,0.65728104843928,0.691483970815453,0.7267484336736111,0.7630993516873085,0.800560753785513,0.8391555834188636,0.8789054865355135,0.9198305865493945,0.9619492451041735,1.0052778071872273,1.0498303289301756,1.0956182863320376,1.1426502630944944,1.190931615763083,1.2404641143778283,1.2912455568490204,1.3432693552124828,1.3965240920241881,1.450993044984143,1.50594324163296,1.5633450502626591,1.6206078829364654,1.6803119694285158,1.7396251002080234,1.801403306504039,1.8625175623825612,1.9250411103672491,1.988433745858061,2.0524838770423366,2.117048351456586,2.181989341390447,2.2471583157289112,2.3123913214954985,2.3775069132490154,2.442304651711493,2.5065636747638655,2.570041222636482,2.6324710849753212,2.6935619607560874,2.752995724530582,2.810425594857516,2.8654742002368714,2.917731537657459,2.966752819523704,3.0120562036169014,3.053120401880494,3.089382161948244,3.120233617604051,3.1450195017513076,3.1630342178746385,3.173518763919451,3.1756575036830403,3.1685747807635822,3.1513313696900265,3.1229207588692613,3.082265261361159,3.028211947410797,2.9595283956621667,2.872516849529258,2.772540866392652,2.6498063259487146,2.5104614070531213,2.3453685926086414,2.1597109816418074,1.9450762657226115,1.705332039148278,1.4330532902006752,1.1294543300462392,0.7912494344927238,0.4156878524203274,8.3965519070013e-15},
    {0.014889158926498964,0.029850622272042132,0.04488079934874819,0.05999371866083177,0.07518118722197985,0.09047579196535054,0.1058528833623099,0.12136438467012779,0.13696371649350228,0.15272833408916794,0.16858372473289734,0.18463912280855904,0.2007856450279197,0.2171709511314037,0.23370188402358252,0.2504116499648954,0.267314775543589,0.28442229128211205,0.301744664196776,0.31929234544511026,0.3370758552765669,0.35510577299329077,0.3733927016296952,0.39194722007272575,0.4107798246533545,0.42990086057325466,0.44932044356654954,0.4690483726494083,0.4890940351707145,0.5094663057244316,0.5301734405952028,0.5512229693088365,0.5726215846357716,0.5943750318967814,0.6164879980130893,0.6389640001218079,0.6618052732581761,0.6850126562092357,0.7085854744925597,0.7325214193492419,0.7568164216807227,0.7814645199597537,0.8064577212692728,0.8317858547497439,0.8574364168317066,0.8833944076671257,0.9096421583260894,0.9361591482468341,0.9622231731745362,0.9897749078623023,1.0162890750439195,1.0442566950956624,1.070998547583557,1.099207088708632,1.1260043978821348,1.1533252486101075,1.1806966697037018,1.2079583841617523,1.2350199701833546,1.2618029062270104,1.2882265395696617,1.3142044996747815,1.3396435616977966,1.3644430684213038,1.3884944664369554,1.4116808537570893,1.433876513764711,1.4549464300661175,1.474745779866659,1.493119405126844,1.50990126068171,1.5249138384271825,1.5379675671041801,1.54886018676409,1.5573760974902473,1.5632856813304148,1.5663445972795065,1.5662930482578945,1.5628550199309144,1.5557374906129202,1.5446296118543654,1.5292018594930834,1.5091051547332857,1.483969954944227,1.453405314440874,1.4169979146990552,1.374311064804005,1.3233495089326794,1.2679882835674894,1.2023924171516114,1.1309409571674072,1.048380516565,0.9584760849657653,0.8565819540624965,0.7456614270662085,0.6218221384376352,0.4864619924932259,0.33830036668017144,0.1764334986514013,-3.3128596634944894e-15},
    {0.016808902131409554,0.03324752695396369,0.04930931062599283,0.0650317489466,0.08037108845121477,0.09542289532566968,0.11010028085215261,0.12453933678634457,0.1386080237139492,0.15248844936222897,0.16599953606396012,0.17937368645129753,0.19237657839636715,0.2052952670138075,0.21793987917532587,0.2303693085694069,0.2426039326664913,0.25465690012133047,0.26653988769255343,0.27826415114665876,0.28984070611318324,0.3012803430475636,0.3125936054459006,0.3237907549391224,0.33488172782394676,0.3458760844431417,0.35678295268973953,0.3676109672177872,0.37836820628266554,0.38906212826013636,0.399699509843341,0.4102863876299158,0.4208280043385519,0.43132876033328965,0.4417921705319931,0.4522208262640875,0.4626163612402644,0.47297942058036024,0.4833096317660026,0.49360557644779013,0.503864762183874,0.5140835933663083,0.5242573407849969,0.5343801094443954,0.5444448043728699,0.5544430942493478,0.5643653727660781,0.5742007176537192,0.5833501309252359,0.5934533949510268,0.6024141822820458,0.6122913380587145,0.6209238094868599,0.6304811192515175,0.6387040250717761,0.647132330872423,0.655410191079928,0.6634331286964427,0.6711542981864651,0.6785387725163755,0.6855527783444567,0.6921611387393664,0.6983266246941084,0.7040097449772327,0.7091686340116071,0.7137589600062582,0.7177338353744686,0.7210437256050307,0.7236363555278005,0.7254566127907169,0.7264464484864965,0.7265447747974368,0.7256873597375184,0.723806718900606,0.7208320042605691,0.7166888899775503,0.7112994552961577,0.7045820645222266,0.6964512441701034,0.686817557372906,0.6755874755992495,0.6626632478979743,0.6479427677583407,0.6313194377559765,0.6126820323052893,0.5919145585854109,0.5688961161682241,0.5426681534249633,0.5154671807421188,0.48428125122499177,0.45159940873943916,0.4147918088508689,0.3759967345890716,0.33296593688584103,0.28740379489081497,0.23750591468523966,0.1841772518883209,0.12697161786937858,0.06564798751073027,3.1996008949588743e-15},
    {0.02417635461766393,0.04679192298783385,0.06778370946172929,0.0872810570195129,0.10534053262376952,0.12212735306657867,0.13764575469412801,0.15208915538281118,0.16540586379173905,0.17782641673318758,0.18923882599024336,0.1999179632305521,0.20968723403751588,0.21887245855916307,0.227329986739256,0.2351563791082792,0.24240776649066753,0.24913039153500047,0.25536640552513323,0.26115505248945536,0.266532981191019,0.2715343811506681,0.2761910739284932,0.2805325867175733,0.2845862157124465,0.28837708399346834,0.29192819754426486,0.29526050321940356,0.2983929513167859,0.3013425650469433,0.3041245179368826,0.30675221893314236,0.30923740430884167,0.3115902341609195,0.3138193913711693,0.3159321801174705,0.317934621839691,0.3198315465390099,0.3216266780406903,0.3233227124215813,0.3249213892831367,0.3264235560374023,0.3278292255989114,0.32913762807904695,0.33034725712677526,0.3314559114814057,0.33246073245579183,0.33335823779592416,0.3336752662359115,0.3347300109808253,0.33486514827890373,0.3356972789561317,0.33556860523145576,0.3361357087389624,0.335715707371074,0.3354658650437889,0.33512926755007916,0.33463973465129626,0.333975209903389,0.3331234992097231,0.3320743751032722,0.33081777895781733,0.32934342116976056,0.3276406984912095,0.3256986819935123,0.323506120405011,0.32105144606496405,0.31832278100876643,0.3153079424334724,0.3119944475145256,0.3083695175391718,0.3044200813376928,0.3001327781103019,0.2954939596125079,0.29048969178917644,0.28510575585465586,0.27932764889823336,0.2731405840507588,0.2665294902633095,0.2594790117889911,0.2519735073972979,0.24399704940886302,0.23553342263546986,0.22656612326958914,0.21707835785309482,0.2070530423429285,0.19647280144491264,0.18494282648453517,0.17351804050054928,0.16088605029000674,0.1481943504569624,0.13433878695766086,0.12028831128118178,0.1051350673505305,0.08964365984518582,0.07311832601713687,0.055983517555421136,0.03811036658688935,0.019457419451991212,1.381099760629511e-16},
    {0.9537611951626184,0.9096851195795536,0.8678717970282558,0.8282490451607446,0.7905726524368942,0.7549062477342735,0.7209447104026097,0.688825118247277,0.6581924939655934,0.6292528199567672,0.6016059740360674,0.5755204414888001,0.5505543455000296,0.5270331763222975,0.5046073443458762,0.4832839759813189,0.4630173905836014,0.44375508719268303,0.42544562430052346,0.40803984452262543,0.391490939126781,0.37575432090777183,0.3607874768678537,0.34654983142153506,0.3330026262158476,0.32010881740801744,0.30783299030069233,0.2961412900126413,0.2850013665757085,0.2743823318441758,0.2642547252889538,0.25459048564547937,0.2453629251689157,0.23654670398346925,0.22811780214930127,0.2200534882639382,0.21233228365263682,0.20493392221176115,0.19783930631796048,0.19103045958450776,0.1844904774385279,0.17820347647686746,0.17215454352473727,0.16632968515164678,0.1607157782547758,0.15530052220464896,0.15007239276758258,0.14502059805002201,0.1399730335763396,0.13537805021916968,0.13066488156134237,0.1263568298500046,0.12192299540898285,0.11786516748023948,0.11368104633962973,0.10970469219573782,0.10585574040374013,0.1021120010799568,0.09846468893899468,0.09490827070214444,0.09143818666597613,0.08805033209093854,0.08474092904219065,0.08150648469302867,0.07834376936005831,0.07524979921880792,0.07222182092187225,0.0692572970495793,0.06635389243826802,0.063509461174998,0.06072203428256881,0.057989808074702685,0.055311133076487606,0.05268450358139542,0.05010854767045477,0.04758201788821933,0.045103782296532634,0.04267281612997594,0.04028819381913842,0.03794908151770971,0.03565473003574536,0.03340446816964614,0.031197696415606633,0.029033881091336686,0.02691254875329298,0.024833280984873654,0.022795709492133512,0.020764990485146403,0.018839217440459778,0.01690125534442378,0.015052348971490145,0.01320103229525598,0.011427416411731355,0.009661652225049139,0.007963075930169075,0.00628210781819136,0.00465060938268153,0.003060570503020491,0.001510467557254457,8.278108041919863e-17},
    {4.654670313152953e-06,9.999604684828761e-06,1.6111369824621324e-05,2.3055669048262073e-05,3.09758384024379e-05,3.990395277560046e-05,5.004464789717674e-05,6.140891410471727e-05,7.427455835476789e-05,8.862467939012152e-05,0.0001048260263909277,0.00012282703555523873,0.00014310240563520868,0.00016555802434485453,0.00019067111964604153,0.00021865546272150147,0.00024979436309497527,0.00028440824271375805,0.00032285077478208616,0.00036551069824726154,0.0004128149669802262,0.00046523243263028456,0.0005232779362102561,0.0005875168147467868,0.0006585698574612433,0.000737118753676658,0.0008239120796644586,0.000919771875427891,0.0010256008676480994,0.0011423903998414207,0.0012712291370090636,0.0014133126192994747,0.0015699537465157043,0.0017425942850369212,0.0019328174974057456,0.0021423620069593997,0.0023731370201049216,0.002627239042487213,0.0029069702385287515,0.003214858598752179,0.003553680095666052,0.003926483026639629,0.004336614762053768,0.00478775113860681,0.005283928761692673,0.005829580508020447,0.006429574547470328,0.007089257236982866,0.007817275871741603,0.00861227665471421,0.009491399930805753,0.010451926424229105,0.011513710082853734,0.012674072822664573,0.01395620843067657,0.015362333858891547,0.016906764990220504,0.01860363354710321,0.020468077137119397,0.022516634351901182,0.024767456653676682,0.027240486821637024,0.029957642060855903,0.032943012398067927,0.03622307840609881,0.03982695080762636,0.04378663438308186,0.04813731869978435,0.052917698463399,0.05817032655222125,0.06394200313393782,0.07028420462422054,0.07725355663140683,0.08491235549723201,0.09332914350103523,0.10257934339116064,0.11274595844361784,0.12392034499448383,0.1362030650640594,0.14970482758138073,0.1645475276005319,0.18086539392738207,0.19880625672177224,0.2185329479153958,0.2402248486405819,0.26407959951412485,0.29031499126717353,0.319197030212893,0.35091661252341055,0.385857346223628,0.4242516947883513,0.466543037461266,0.5130361274743094,0.5642457873368786,0.6205695705160461,0.6826055871548379,0.7508844613759522,0.8260581824121134,0.9088362165842668,0.9999999999999882}
    };

  const double taum[9][100] = {
    {0.0013951860226007811,0.0013753880061651005,0.0013557622538365698,0.0013352413517518718,0.0013168289236364207,0.0012969890874456361,0.0012790853671317004,0.0012597874329837505,0.0012423679839196802,0.0012235968377022964,0.001206646930984487,0.0011883851859455685,0.0011718883958011502,0.0011541176454854794,0.0011372044088068176,0.0011206176941710494,0.0011042673121035825,0.0010881352827871857,0.0010722156851080905,0.0010565047896740343,0.0010409994376112224,0.001025696779452636,0.001010594236587782,0.0009956894948837264,0.0009809804983309223,0.0009664654363320782,0.0009521427238404701,0.0009380109740853932,0.0009240689651574921,0.0009103156016557403,0.0008967498733511152,0.0008833708132857616,0.0008701774572680021,0.0008571688071973855,0.0008443437994251335,0.0008317012797047429,0.0008192399847854716,0.0008069585307656063,0.0007948554075754987,0.0007829289786971566,0.0007711774850962128,0.0007595990522546893,0.0007481916993331406,0.0007369533495974601,0.0007258818414282838,0.0007149749395265597,0.000704230345760498,0.0006936457095424954,0.0006836677133904321,0.0006730240203032007,0.0006632719310225697,0.000652933675153835,0.0006434592364249188,0.0006334312629220628,0.0006242276867884155,0.0006148971108136841,0.0006056450278253909,0.0005965153827231426,0.0005875160750988196,0.0005786469738033136,0.0005699061883440783,0.0005612914626592984,0.000552800483446698,0.0005444309487954384,0.0005361805846927555,0.0005280471493976048,0.0005200284356767116,0.0005121222719683705,0.0005043265234926423,0.0004966390930558026,0.0004890579217262796,0.0004815809894773096,0.00047420631557937895,0.00046693195903020553,0.00045975601864411915,0.0004526766333674885,0.0004456919821813557,0.00043880028422126863,0.000431999798565165,0.0004252888241035983,0.00041866569932941613,0.00041212880200132705,0.00040567654874991454,0.00039930739477125757,0.00039301983324569075,0.00038681239495226517,0.00038068364761645275,0.00037487309678937254,0.0003686950515869266,0.0003629938853171777,0.0003569653775703638,0.00035139937509193474,0.0003455226932219114,0.00034008857731617837,0.0003343587675174895,0.0003290523764634174,0.000323671848501927,0.0003183261701140213,0.0003130381725174668,3.573956487406927e-05},
    {0.005113124982052405,0.005035919018415059,0.004959672943282183,0.0048794226217568955,0.004809228968971925,0.0047325646952207,0.004665066029783171,0.004591287877562304,0.004526327034377078,0.004455315678376619,0.004392781573467912,0.004324409121615808,0.004264185082648254,0.004198321820903371,0.004136458787771959,0.004076178277777525,0.004017063248096325,0.003959023471693602,0.003902023380558991,0.0038460375549585137,0.0037910434184698586,0.003737020048940187,0.003683947986491838,0.0036318091857345217,0.003580586968289164,0.003530265948611742,0.003480831929656312,0.0034322717686601605,0.00338457321852014,0.0033377247509884245,0.003291715370482577,0.003246534428739253,0.0032021714491974316,0.0031586159705811823,0.003115857415075428,0.0030738849862595886,0.003032687597006725,0.0029922538267388755,0.0029525719047895876,0.0029136297155482826,0.0028754148205604392,0.002837914492676586,0.002801115757917709,0.002765005441377913,0.002729570214309106,0.0026947966406268044,0.0026606712209289165,0.002627180433486403,0.0025961980954908753,0.0025623737099097267,0.0025322476357736846,0.0024996104709163946,0.0024705475311380385,0.0024391064014115276,0.0024110684443051276,0.0023824383705744576,0.0023540763096859814,0.002326164809107559,0.0022987352081568417,0.0022717852558698667,0.0022453054367797443,0.0022192848168770007,0.0021937123324653014,0.0021685770727722666,0.0021438683430523246,0.0021195756777888063,0.0020956888443171653,0.002072197842726247,0.002049092905403551,0.0020263644957257817,0.002004003306387485,0.001982000257682726,0.0019603464951484188,0.0019390333873553752,0.001918052522856544,0.0018973957077910387,0.001877054962461316,0.001857022518562426,0.0018372908155910306,0.0018178524975536747,0.0017987004095372774,0.0017798275940050104,0.001761227287014321,0.001742892914749104,0.001724818089371295,0.0017069966054913386,0.0016894224359439271,0.0016731567924030348,0.0016551634525320711,0.0016391879506604443,0.0016216509271841154,0.0016060805406126672,0.0015890115797174856,0.0015738331907344237,0.0015572120408988528,0.001542408664255362,0.0015271649625295956,0.0015119746630572468,0.0014969421457947326,0.0010142900712494546},
    {0.016037454062133104,0.015732682651445517,0.015432319111671568,0.015115479264893442,0.014842347699527345,0.014542383352970117,0.014282040528188452,0.013995866179824732,0.013747542881907762,0.013474527069170768,0.013237640944644188,0.012977115018862504,0.012751063398870574,0.012502357524027674,0.012270827038191245,0.012046428228119539,0.011827413100801832,0.011613384086412958,0.011404169439585412,0.011199639941135963,0.010999678860739218,0.010804177008426365,0.010613031853217552,0.01042614722382302,0.010243433007183715,0.010064804741086794,0.009890183090558207,0.009719493215772762,0.009552664056884241,0.009389627565796891,0.009230317922885343,0.009074670780059257,0.008922622566256316,0.008774109889516737,0.008629069055174332,0.008487435714423737,0.008349144640825916,0.008214129626761211,0.008082323483046184,0.007953658121251176,0.00782806469710744,0.007705473794237112,0.007585815630246514,0.007469020270575884,0.007355017839149431,0.007243738718959262,0.007135113736546621,0.007029074328558008,0.006932269928390586,0.006825634361940522,0.006732385345637596,0.0066305422819500975,0.006541525983115517,0.006444434335881696,0.006359455018292021,0.006272631380844838,0.006186956897257092,0.0061030537836488435,0.006021016911439469,0.005940824956541895,0.005862432042846301,0.005785787995625349,0.005710842774194621,0.005637547425286077,0.005565854278659426,0.005495716973450084,0.005427090450128856,0.00535993093122047,0.00529419590028224,0.00522984407876228,0.005166835401886466,0.005105130994471078,0.005044693145454783,0.004985485282828149,0.0049274719470981145,0.004870618766222896,0.00481489242882183,0.00476026065892114,0.004706692189446195,0.004654156736602903,0.004602624974384404,0.004552068508869684,0.004502459852785947,0.004453772401048528,0.004405980405378354,0.004359058950571906,0.004312983929696735,0.004271042082870771,0.004223809227349152,0.00418288317499165,0.004137205954371211,0.0040976382949908146,0.004053534532399566,0.004015269586504218,0.0039726592493179854,0.003935630639922199,0.0038973098230825408,0.0038591970755317774,0.003821606762266629,0.004631074971328275},
    {0.05279993493452418,0.05158412115950484,0.050384958208675876,0.04911795272598129,0.04803471666103575,0.04684144357593344,0.045814487848907716,0.04468222428806686,0.04370829153472503,0.04263424997267298,0.04171073915521154,0.04069191478255182,0.03981611282884507,0.038849483784624446,0.0379547953466868,0.037090871610821495,0.03625051374452618,0.03543203952907213,0.03463468849546743,0.03385787472334038,0.03310106457460451,0.03236375642096943,0.03164547681600508,0.03094577897782849,0.030264241228633727,0.029600464993540892,0.028954072336285802,0.02832470308920473,0.027712011699558378,0.02711566393503793,0.02653533361612784,0.025970699548270505,0.025421442801484343,0.024887244464095737,0.024367783938716008,0.02386273781521793,0.02337177929401848,0.02289457810525626,0.022430800839094094,0.021980111590272158,0.0215421728193845,0.02111664634108758,0.02070319436377931,0.02030148052166191,0.019911170856704005,0.019531934724558258,0.01916344560526987,0.018805381814096054,0.01848165419637857,0.018123415091913606,0.017814188447572238,0.017475113936679505,0.017182619986541185,0.016862301386578214,0.016585620556022588,0.016303150321604953,0.016025449617415755,0.015754667336121707,0.015491087737476717,0.015234587770825684,0.014984960559827117,0.01474198654393731,0.014505448921874551,0.01427513689438114,0.014050846256559947,0.013832379405646236,0.013619545226635285,0.01341215894285906,0.013210041960332533,0.013013021707475777,0.012820931473170179,0.01263361024593434,0.01245090255184273,0.012272658294876624,0.012098732596507636,0.011928985640107023,0.011763282514455187,0.011601493062444889,0.01144349173006018,0.011289157419389875,0.011138373344663215,0.010991026890325512,0.01084700947234209,0.010706216403950895,0.010568546762202244,0.010433903260468579,0.010302192120997521,0.010183689405320722,0.010048862168559202,0.009933958678520004,0.009804506290085958,0.009694230090212204,0.00957014721131097,0.009464275467996676,0.009345255479974864,0.009243536625372481,0.009138040463707814,0.009033358081455122,0.00893044310660936,0.006109055537008722},
    {0.19077105718675397,0.1857785775644598,0.180831655814991,0.17559575056909973,0.17113029949630892,0.16620500023024012,0.16197941909313313,0.15731525921453499,0.1533177952716733,0.14890449213399415,0.14512507641189445,0.1409507835441711,0.1373784900416618,0.13343098848697005,0.12978834774272496,0.12627848468998018,0.12287136230735213,0.11955996725259647,0.11634112330735612,0.11321237425994737,0.11017147460418929,0.10721630510919333,0.10434485648532033,0.1015552223080358,0.09884559146753637,0.09621423859021518,0.09365951244963426,0.09117982274181659,0.0887736258610307,0.08643941039866636,0.08417568316365004,0.08198095650706885,0.07985373759337283,0.07779252011844418,0.07579577870579539,0.07386196602793134,0.0719895124436496,0.07017682781084333,0.06842230502210395,0.06672432477340673,0.06508126109432853,0.06349148722141144,0.061953381475321465,0.06046533288632886,0.05902574639419083,0.05763304752327491,0.05628568647300448,0.05498214162072514,0.0538127300390374,0.05251623301664557,0.05140832947873196,0.05019170444145124,0.04915289700081818,0.04801353493648956,0.04703946622409901,0.046046698019856475,0.045074347238338475,0.04413019224784085,0.04321508205861128,0.04232836627674974,0.04146909540457439,0.04063628349252833,0.03982896464181884,0.03904620452233225,0.03828710214685259,0.03755078951524733,0.03683643080789114,0.036143221462132134,0.035470387228882044,0.03481718322233366,0.03418289297221242,0.033566827488461466,0.03296832433392987,0.032386746714428025,0.03182148258150598,0.03127194375873877,0.030737565082168638,0.030217803565909362,0.029712137585257658,0.029220066082845525,0.028741107797779827,0.028274800514357934,0.027820700333392054,0.02737838096820271,0.026947433057328295,0.026527463505363603,0.02611809483719199,0.02575312467209295,0.02533517187912044,0.024983429733529024,0.024584813456227785,0.02424952204168797,0.023870002561574195,0.023550252123461735,0.023188618062160236,0.022883423294736693,0.02256661716424996,0.022252980913863324,0.021945558775863974,0.01799510888496639},
    {0.7809137227422597,0.7593759538816741,0.7377860322065601,0.7148667820491856,0.6952152435957809,0.6735422664672002,0.6548735904702585,0.6342762677771626,0.6165650038193018,0.5970212029106916,0.5802402663635493,0.5617155579002617,0.5458306074910533,0.5282860323500935,0.5120816893195865,0.4964625600058085,0.4812987697890737,0.466561765952817,0.45223979195322767,0.4383241337997469,0.42480687311241305,0.41168051555242785,0.3989379177302095,0.38657225231275133,0.37457696857948747,0.36294574213498815,0.35167241465503923,0.34075092629488785,0.33017524461263065,0.3199392942327914,0.31003689167001813,0.3004616894219362,0.29120713252052416,0.2822664297431053,0.27363254020019706,0.26529817490840435,0.25725581168666395,0.24949772103508372,0.24201600019311456,0.23480261249211642,0.22784942933776817,0.22114827254112152,0.2146909552178609,0.2084693199748795,0.2024752735688854,0.1967008176236042,0.1911380752340024,0.1857793135529064,0.18100081645916,0.175708951344239,0.17121994274056235,0.16629698142329075,0.1621250535216365,0.15755512164762298,0.15367789547423,0.1497377796129315,0.14589444715320948,0.14217878508607693,0.13859327998570647,0.13513433805990813,0.13179719798545209,0.12857700041974268,0.12546901588660467,0.12246868968089786,0.11957164722690083,0.11677369082894802,0.11407079456093489,0.11145909870033083,0.10893490407911931,0.10649466643416637,0.10413499079771907,0.101852625971275,0.09964445908212412,0.09750751025274622,0.0954389273867407,0.09343598108808962,0.09149605971339535,0.0896166645677695,0.0877954052455387,0.0860299951140741,0.08431824695123541,0.0826580687239379,0.08104745951474632,0.07948450559830192,0.07796737665046305,0.07649432211334845,0.0750636676773758,0.07379715835519855,0.07234289601177464,0.0711302476483062,0.06975278752536214,0.06860487981735744,0.0673023719251612,0.06621513727621063,0.06498232578785271,0.06395151507055774,0.06288214600986979,0.06182627312166939,0.060794510359968607,0.08171876932662664},
    {3.809244352946817,3.7106131488559,3.609016195091793,3.5004873223741315,3.4057621122081576,3.3014393774303232,3.2101916605942096,3.1097162845593243,3.0220746666110534,2.9255581800753467,2.8415658576662035,2.7490234117272294,2.6686663928662715,2.5800759041446804,2.497605459641878,2.417698667689716,2.3397679188960314,2.2637094407371925,2.189499667685293,2.117129060528457,2.046591187064497,1.9778808479511019,1.910993625219921,1.8459255871824038,1.7826729434816164,1.7212316247202184,1.6615967994186278,1.6037623517255941,1.547720351142614,1.4934605474634608,1.4409699242006444,1.390232339996062,1.341228279533285,1.2939347268982808,1.2483251629803136,1.2043696798535763,1.1620351962001005,1.1212857532132037,1.082082867789497,1.04438591996607,1.0081525538857952,0.9733390749393781,0.9399008298410769,0.9077925603374083,0.8769687248124791,0.8473837850486285,0.818992457334931,0.7917499289404195,0.7675444010562319,0.740863689696108,0.7183164195927948,0.6937046630778402,0.6729332603683159,0.6502851833376216,0.6311545943761033,0.6117998242496397,0.5930058087359373,0.5749195454385718,0.5575476489409978,0.5408669880826719,0.524848944573774,0.5094646735213825,0.49468621857333833,0.48048672802633735,0.46684047624589164,0.45372284210843383,0.44111027738541775,0.42898027225910906,0.4173113198407137,0.40608288030812123,0.3952753449735944,0.3848700005808319,0.37484899396080396,0.3651952972331528,0.3558926736942824,0.34692564442747703,0.33827945580311053,0.3299400478298693,0.32189402350303287,0.31412861907720085,0.30663167536769875,0.29939161004581655,0.2923973909388829,0.28563851034345433,0.2791049603165503,0.27278720899079023,0.2666761777881689,0.2612974877553362,0.25512537156115395,0.2500145179831414,0.24421304111025577,0.23941259189394293,0.23396812709335146,0.22945591791289807,0.22434072431308344,0.2200943688812695,0.21569788543007556,0.21137059283659554,0.20715662396075402,0.12604131513621325},
    {27.145051513442475,26.560080432217227,25.899187285048495,25.18839229101775,24.545927070831734,23.850832706133254,23.225318252757045,22.549410986885658,21.943520113935637,21.28802270213525,20.702092038381057,20.066916637827383,19.500646445567543,18.885435511783637,18.30445576716862,17.737216145195692,17.180322399006357,16.63322492792979,16.09587768763855,15.568349431587459,15.050758075541607,14.54325794082807,14.04603472270993,13.5593005857027,13.083288167244266,12.618243413193634,12.164417460875692,11.722057903302844,11.291399859791277,10.872657312748517,10.46601517099626,10.071622470368606,9.689587025386201,9.319971728411204,8.962792553376577,8.618018199508061,8.285571200956895,7.965330258736563,7.657133513459157,7.360782472094346,7.076046323635302,6.802666415017394,6.540360704380174,6.288828054647211,6.047752272436333,5.816805833236983,5.595653260788963,5.383954150375232,5.195474697166273,4.9899425680163265,4.81553113350693,4.627086127716379,4.46747165148648,4.2951979748859355,4.149238642676763,4.002510840389384,3.8606484002537815,3.724669720378657,3.5945778264753074,3.4701618492116237,3.351172469263127,3.23736000355099,3.1284825698243552,3.0243077519344976,2.924612836055266,2.8291847133778916,2.737819685720364,2.6503232314659186,2.566509746681422,2.486202269634752,2.40923219309495,2.335438968520405,2.264669805599586,2.196779369491676,2.1316294791586157,2.0690888068788187,2.0090325829283535,1.9513423043878093,1.895905451344947,1.842615209561388,1.7913702013266422,1.7420742248204277,1.6946360021419398,1.648968936181539,1.6049908769565733,1.5626238971110042,1.5217940764040792,1.4858689653228137,1.4450179737705522,1.4111399397000848,1.3730129481722155,1.341415489489477,1.305878429439208,1.2763803280704342,1.2432139881661057,1.2156376027409714,1.1872359609266514,1.1593805566127955,1.132342122650857,15.31683290413724},
    {318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703,318688.1368554703}
    };

}

/*----------------------------------------------------------------------
 |  The precomputed beta and tau values are given here. For now, only
 |  N_p = 9 Prony terms are included (for 500 Fourier series approximations)
 |
 |  More should be imported from the matlab data files at a later time
 -----------------------------------------------------------------------*/